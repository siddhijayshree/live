/*
 Copyright (c)2006-2017 Nicholas K. Dionysopoulos
 @license   GNU General Public License version 3, or later
*/
if("undefined"==typeof Solo)var Solo={};"undefined"==typeof Solo.Backup&&(Solo.Backup={URLs:{},tag:"",backupid:null,currentDomain:null,domains:{},commentEditorSave:null,maxExecutionTime:14,runtimeBias:75,srpInfo:{},returnUrl:"",config_angiekey:"",defaultDescription:"",currentDescription:"",currentComment:"",jpsKey:"",timeoutTimer:null,resumeTimer:null,translations:{},resume:{enabled:!0,timeout:10,maxRetries:3,retry:0,showWarnings:0}});
Solo.Backup.timer=function(a){0>=a&&(a=10);setTimeout("Solo.Backup.timerTick()",a)};Solo.Backup.timerTick=function(){try{console.log("Timer tick")}catch(a){}Solo.Backup.resetTimeoutBar();Solo.Backup.startTimeoutBar(Solo.Backup.maxExecutionTime,Solo.Backup.runtimeBias);Solo.System.doAjax({ajax:"step",tag:Solo.Backup.tag,backupid:Solo.Backup.backupid},Solo.Backup.onStep,Solo.Backup.onError,!1)};
Solo.Backup.startTimeoutBar=function(a,d){var b=0;Solo.Backup.timeoutTimer=setInterval(function(){b++;var a=document.querySelector("#response-timer div.text");a&&(a.textContent=Solo.Backup.translations["UI-LASTRESPONSE"].replace("%s",b.toFixed(0)))},1E3)};
Solo.Backup.resetTimeoutBar=function(){Piecon.setOptions({color:"#333333",background:"#e0e0e0",shadow:"#000000",fallback:"force"});try{clearInterval(Solo.Backup.timeoutTimer)}catch(a){}var d=document.querySelector("#response-timer div.text");d&&(d.textContent=Solo.Backup.translations["UI-LASTRESPONSE"].replace("%s","0"))};
Solo.Backup.startRetryTimeoutBar=function(){var a=Solo.Backup.resume.timeout;Solo.Backup.resumeTimer=setInterval(function(){a--;document.getElementById("akeeba-retry-timeout").textContent=a.toFixed(0);0==a&&(clearInterval(Solo.Backup.resumeTimer),Solo.Backup.resumeBackup())},1E3)};Solo.Backup.resetRetryTimeoutBar=function(){clearInterval(Solo.Backup.resumeTimer);document.getElementById("akeeba-retry-timeout").textContent=Solo.Backup.resume.timeout.toFixed(0)};
Solo.Backup.renderBackupSteps=function(a){var d="label-success";""==a&&(d="label-default");document.getElementById("backup-steps").innerHTML="";for(var b=0;b<Solo.Backup.domains.length;b++){element=Solo.Backup.domains[b];var c=document.createElement("div");c.className="label ";c.innerHTML=element[1];Solo.System.data.set("domain",element[0]);document.getElementById("backup-steps").appendChild(c);element[0]==a?(d="label-default",this_class="label-info"):this_class=d;c.className+=" "+this_class}};
Solo.Backup.start=function(){try{console.log("Starting backup"),console.log(data)}catch(a){}if(window.AVGRUN){try{console.warn("AVG Antivirus with Link Checker detected. The backup WILL fail!")}catch(d){}if(!confirm(Solo.Backup.translations.SOLO_BACKUP_AVGWARNING))return}try{null!=Solo.Backup.commentEditorSave&&Solo.Backup.commentEditorSave()}catch(b){document.getElementById("comment").value=""}var c="";try{c=document.getElementById("jpskey").value()}catch(e){c=""}var f="";try{f=document.getElementById("angiekey").value()}catch(g){f=
""}document.getElementById("backup-setup").style.display="none";document.getElementById("backup-progress-pane").style.display="block";f&&""==Solo.Backup.config_angiekey&&(document.getElementById("angie-password-warning").style.display="block");Solo.System.notification.notify(Solo.Backup.translations["UI-BACKUPSTARTED"]+" "+(new Date).toLocaleString());Solo.Backup.renderBackupSteps("");Solo.Backup.startTimeoutBar(Solo.Backup.maxExecutionTime,Solo.Backup.runtimeBias);Solo.Backup.tag=Solo.Backup.srpInfo.tag;
c={ajax:"start",description:document.getElementById("backup-description").value,comment:document.getElementById("comment").value,jpskey:c,angiekey:f};c=array_merge(c,Solo.Backup.srpInfo);Solo.System.doAjax(c,Solo.Backup.onStep,Solo.Backup.onError,!1)};
Solo.Backup.onStep=function(a){try{console.log("Running backup step"),console.log(a)}catch(d){}Solo.Backup.renderBackupSteps(a.Domain);Solo.Backup.currentDomain=a.Domain;document.querySelector("#backup-percentage div.bar").style.width=a.Progress+"%";100<=a.Progress?Piecon.setProgress(99):Piecon.setProgress(a.Progress);document.getElementById("backup-step").textContent=a.Step;document.getElementById("backup-substep").textContent=a.Substep;if(0<a.Warnings.length){-1==document.getElementById("backup-percentage").className.indexOf("progress-warning")&&
(document.getElementById("backup-percentage").className+=" progress-warning");for(var b=0;b<a.Warnings.length;b++){warning=a.Warnings[b];Solo.System.notification.notify(Solo.Backup.translations["UI-BACKUPWARNING"],warning);var c=document.createElement("div");c.textContent=warning;document.getElementById("warnings-list").appendChild(c)}document.getElementById("backup-warnings-panel").style.display="block"}b=a.Error;if(""!=b){try{console.error("Got an error message"),console.log(b)}catch(e){}Solo.Backup.onError(b)}else if(1==
a.HasRun){try{console.log("Backup complete"),console.log(b)}catch(f){}Solo.Backup.onDone()}else{empty(Solo.Backup.tag)&&(Solo.Backup.tag="backend");Solo.Backup.backupid=a.backupid;Solo.Backup.resume.retry=0;b=10;a.hasOwnProperty("sleepTime")&&(b=a.sleepTime);try{console.log("Starting tick timer with waitTime = "+b+" msec")}catch(g){}Solo.Backup.timer(b)}};
Solo.Backup.resumeBackup=function(){Solo.Backup.resetRetryTimeoutBar();document.getElementById("error-panel").style.display="none";document.getElementById("retry-panel").style.display="none";document.getElementById("backup-progress-pane").style.display="block";Solo.Backup.resume.showWarnings&&(document.getElementById("backup-warnings-panel").style.display="block");Solo.System.notification.notify(Solo.Backup.translations["UI-BACKUPRESUME"]+" "+(new Date).toLocaleString());Solo.Backup.timer()};
Solo.Backup.cancelResume=function(){Solo.Backup.resetRetryTimeoutBar();var a=document.getElementById("backup-error-message-retry").innerHTML;Solo.Backup.endWithError(a)};
Solo.Backup.onError=function(a){if(Solo.Backup.resume.enabled)if(Solo.Backup.resume.retry>=Solo.Backup.resume.maxRetries)Solo.Backup.endWithError(a);else{Solo.Backup.resume.retry++;Solo.Backup.resetRetryTimeoutBar();var d=Solo.Backup.translations["UI-BACKUPHALT_DESC"].replace("%d",Solo.Backup.resume.timeout.toFixed(0));Solo.System.notification.notify(Solo.Backup.translations["UI-BACKUPHALT"],d);Solo.Backup.resume.showWarnings="none"!==document.getElementById("backup-warnings-panel").style.display;
document.getElementById("backup-progress-pane").style.display="none";document.getElementById("backup-warnings-panel").style.display="none";document.getElementById("error-panel").style.display="none";document.getElementById("backup-error-message-retry").textContent=a;document.getElementById("retry-panel").style.display="block";Solo.Backup.startRetryTimeoutBar()}else Solo.Backup.endWithError(a)};
Solo.Backup.endWithError=function(a){Solo.Backup.resetTimeoutBar();try{Piecon.reset()}catch(d){}var b=!1;document.getElementById("backup-progress-pane").style.display="none";document.getElementById("backup-warnings-panel").style.display="none";document.getElementById("retry-panel").style.display="none";var c=Solo.Backup.URLs.LogURL+"&tag="+Solo.Backup.tag,e=Solo.Backup.URLs.AliceURL+"&log="+Solo.Backup.tag;Solo.Backup.backupid&&(c=c+"."+encodeURIComponent(Solo.Backup.backupid),e=e+"."+encodeURIComponent(Solo.Backup.backupid));
"finale"==Solo.Backup.currentDomain&&(b=!0,e+="&autorun=1");document.getElementById("ab-viewlog-error").setAttribute("href",c);document.getElementById("ab-alice-error").setAttribute("href",e);Solo.System.notification.notify(Solo.Backup.translations["UI-BACKUPFAILED"],a);Solo.System.doAjax({ajax:"pushFail",tag:Solo.Backup.tag,backupid:Solo.Backup.backupid,errorMessage:a},function(a){});document.getElementById("backup-error-message").textContent=a;document.getElementById("error-panel").style.display=
"block";b&&setTimeout(function(){window.location=e},500)};
Solo.Backup.onDone=function(){Solo.System.notification.notify(Solo.Backup.translations["UI-BACKUPFINISHED"]+" "+(new Date).toLocaleString());Solo.Backup.resetTimeoutBar();try{Piecon.reset()}catch(a){}document.getElementById("backup-progress-pane").style.display="none";document.getElementById("backup-complete").style.display="block";document.getElementById("backup-warnings-panel").style.width="100%";var d=Solo.Backup.URLs.LogURL+"&tag="+Solo.Backup.tag;Solo.Backup.backupid&&(d=d+"."+encodeURIComponent(Solo.Backup.backupid));
try{document.getElementById("ab-viewlog-success").setAttribute("href",d)}catch(b){}""!=Solo.Backup.returnUrl&&(window.location=Solo.Backup.returnUrl)};
Solo.Backup.restoreDefaultOptions=function(){document.getElementById("backup-description").value=Solo.Backup.defaultDescription;var a=document.getElementById("angiekey");a&&(a.value="ChromeIsDumb",a.value=Solo.Backup.config_angiekey);if(a=document.getElementById("jpskey"))a.value="ChromeIsDumb",a.value=Solo.Backup.jpsKey;document.getElementById("comment").value="ChromeIsDumb";document.getElementById("comment").value=""};
Solo.Backup.restoreCurrentOptions=function(){document.getElementById("backup-description").value=Solo.Backup.currentDescription;var a=document.getElementById("angiekey");a&&(a.value="ChromeIsDumb",a.value=Solo.Backup.config_angiekey);if(a=document.getElementById("jpskey"))a.value="ChromeIsDumb",a.value=Solo.Backup.jpsKey;document.getElementById("comment").value="ChromeIsDumb";document.getElementById("comment").value=Solo.Backup.currentComment};
Solo.Backup.flipProfile=function(){document.getElementById("flipDescription").value=document.getElementById("backup-description").value;document.getElementById("flipComment").value=document.getElementById("comment").value;document.forms.flipForm.submit()}; //#sourceMappingURL=backup.min.map
