/*
   2014-2017 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license     GNU GPL version 3 or later
*/
if("undefined"==typeof Solo)var Solo={};"undefined"==typeof Solo.Multidb&&(Solo.Multidb={translations:{}});Element.prototype.cloneNode=function(c,d){return function(h){h===d&&(h=!1);h=c.call(this,h);"checked"in this&&(h.checked=this.checked);return h}}(Element.prototype.cloneNode);Solo.Multidb.render=function(c){var d=document.getElementById("ak_list_contents");d.innerHTML="";for(rootname in c)c.hasOwnProperty(rootname)&&Solo.Multidb.addRow(rootname,c[rootname],d);Solo.Multidb.addNewRecordButton(d)};
Solo.Multidb.addRow=function(c,d,h){var k=document.createElement("tr");k.className="ak_filter_row";Solo.System.data.set(k,"root",c);Solo.System.data.set(k,"def",JSON.stringify(d));var m=document.createElement("td");m.style.width="2em";var l=document.createElement("span");l.className="ak_filter_tab_icon_container btn-sm btn-danger btn-default";Solo.System.addEventListener(l,"click",function(){var c={root:Solo.System.data.get(this.parentNode.parentNode,"root"),verb:"remove"};Solo.Fsfilters.toggle(c,
this,function(c,d){if(1==c.success){var b=d.parentNode.parentNode;b.parentNode.removeChild(b)}})});var e=document.createElement("span");e.className="ak-toggle-button fa fa-trash-o deletebutton";l.appendChild(e);m.appendChild(l);l=document.createElement("td");l.style.width="2em";e=document.createElement("span");e.className="ak_filter_tab_icon_container btn btn-default";Solo.System.addEventListener(e,"click",function(){var d=this.parentNode.parentNode,b=JSON.parse(Solo.System.data.get(d,"def","{}"));
Solo.System.data.get(d,"root");var e=document.getElementById("akEditorDialog");""==b.driver&&(b.driver="mysqli");document.getElementById("ake_driver").value=b.driver;document.getElementById("ake_host").value=b.host;document.getElementById("ake_username").value=b.username;document.getElementById("ake_password").value=b.password;document.getElementById("ake_database").value=b.database;document.getElementById("ake_prefix").value=b.prefix;try{var f=document.getElementById("ak_editor_notifier");f.parentNode.removeChild(f)}catch(a){}b=
document.getElementById("akEditorBtnDefault");f=b.cloneNode(!0);b.parentNode.replaceChild(f,b);Solo.System.addEventListener(f,"click",function(){try{var a=document.getElementById("ak_editor_notifier");a.parentNode.removeChild(a)}catch(p){}a=document.createElement("div");a.className="alert alert-info alert-dismissable";a.id="ak_editor_notifier";a.insertAdjacentHTML("afterbegin",'<span type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</span>');var d=document.createElement("span");
d.id="ak_editor_notifier_content";a.appendChild(d);var b=document.createElement("img");b.setAttribute("border",0);b.setAttribute("src",Solo.Multidb.loadingGif);d.appendChild(b);b=document.createElement("span");b.textContent=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_LOADING;d.appendChild(b);document.getElementById("ak_editor_table").insertAdjacentHTML("beforebegin",a.outerHTML);a=document.getElementById("ake_driver");a=a.options[a.selectedIndex];a=null==a?"":a.value;a={verb:"test",root:c,
data:{host:document.getElementById("ake_host").value,driver:a,port:document.getElementById("ake_port").value,user:document.getElementById("ake_username").value,password:document.getElementById("ake_password").value,database:document.getElementById("ake_database").value,prefix:document.getElementById("ake_prefix").value}};a={akaction:JSON.stringify(a)};Solo.System.doAjax(a,function(a){var b=document.getElementById("ak_editor_notifier_content");1==a.status?b.textContent=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTOK:
b.innerHTML=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTFAIL+"<br/><code>"+a.message+"</code>"},function(a){document.getElementById("ak_editor_notifier_content").textContent=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTFAIL;"object"==typeof Solo.Multidb.modalDialog&&Solo.Multidb.modalDialog.close&&Solo.Multidb.modalDialog.close();Solo.System.params.errorCallback(a)},!1,15E3)});b=document.getElementById("akEditorBtnSave");f=b.cloneNode(!0);b.parentNode.replaceChild(f,
b);Solo.System.addEventListener(f,"click",function(){try{var a=document.getElementById("ak_editor_notifier");a.parentNode.removeChild(a)}catch(q){}a=document.createElement("div");a.className="alert alert-info alert-dismissable";a.id="ak_editor_notifier";a.insertAdjacentHTML("afterbegin",'<span type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</span>');var b=document.createElement("span");b.id="ak_editor_notifier_content";a.appendChild(b);var e=document.createElement("img");
e.setAttribute("border",0);e.setAttribute("src",Solo.Multidb.loadingGif);b.appendChild(e);e=document.createElement("span");e.textContent=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_LOADING;b.appendChild(e);document.getElementById("ak_editor_table").insertAdjacentHTML("beforebegin",a.outerHTML);var a=document.getElementById("ake_driver"),a=a.options[a.selectedIndex],a=null==a?"":a.value,f={verb:"set",root:c,data:{host:document.getElementById("ake_host").value,driver:a,port:document.getElementById("ake_port").value,
username:document.getElementById("ake_username").value,password:document.getElementById("ake_password").value,database:document.getElementById("ake_database").value,prefix:document.getElementById("ake_prefix").value,dumpFile:String(c).substr(0,9)+document.getElementById("ake_database").value+".sql"}},a={akaction:JSON.stringify(f)};Solo.System.doAjax(a,function(a){1!=a?document.getElementById("ak_editor_notifier_content").textContent=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_SAVEFAIL:(Solo.System.data.set(d,
"def",JSON.stringify(f.data)),d.querySelectorAll("td"),d.querySelector("span.ak_dbhost").textContent=f.data.host,d.querySelector("span.ak_dbname").textContent=f.data.database,-1==d.querySelector("span.editbutton").className.indexOf("fa-pencil-square")&&(d.querySelector("span.deletebutton").parentNode.style.display="inline-block",a=d.querySelector("span.editbutton"),Solo.System.removeClass(a,"fa-plus-square"),Solo.System.removeClass(a.parentNode,"btn-success"),Solo.System.addClass(a,"fa-pencil-square ak-toggle-button"),
Solo.Multidb.addNewRecordButton(d.parentNode)),"object"==typeof Solo.Multidb.modalDialog&&Solo.Multidb.modalDialog.close&&Solo.Multidb.modalDialog.close())},function(a){document.getElementById("ak_editor_notifier_content").textContent=Solo.Multidb.translations.COM_AKEEBA_MULTIDB_GUI_LBL_SAVEFAIL;"object"==typeof Solo.Multidb.modalDialog&&Solo.Multidb.modalDialog.close&&Solo.Multidb.modalDialog.close();Solo.System.params.errorCallback(a)},!1,15E3)});b=document.getElementById("akEditorBtnCancel");f=
b.cloneNode(!0);b.parentNode.replaceChild(f,b);Solo.System.addEventListener(f,"click",function(){"object"==typeof Solo.Multidb.modalDialog&&Solo.Multidb.modalDialog.close&&Solo.Multidb.modalDialog.close()});Solo.Multidb.modalDialog=Solo.Modal.open({inherit:e,width:"80%"});Solo.System.triggerEvent(e.querySelector("span"),"focus")});var g=document.createElement("span");g.className="fa fa-pencil-square editbutton ak-toggle-button";e.appendChild(g);l.appendChild(e);e=document.createElement("td");e.className=
"ak_filter_item";g=document.createElement("span");g.className="ak_filter_name ak_dbhost";g.textContent=d.host;e.appendChild(g);g=document.createElement("td");g.className="ak_filter_item";var n=document.createElement("span");n.className="ak_filter_name ak_dbname";n.textContent=d.database;g.appendChild(n);k.appendChild(m);k.appendChild(l);k.appendChild(e);k.appendChild(g);h.appendChild(k)};
Solo.Multidb.addNewRecordButton=function(c){var d=Math.uuid();Solo.Multidb.addRow(d,{host:"",port:"",username:"",password:"",database:"",prefix:""},c);c=document.getElementById("ak_list_contents").children;c=c[c.length-1].querySelectorAll("td");c[0].querySelector("span").style.display="none";c=c[1].querySelectorAll("span");c=c[c.length-1];Solo.System.removeClass(c,"fa-pencil-square");Solo.System.addClass(c,"fa-plus-square ak-toggle-button");Solo.System.addClass(c.parentNode,"btn-success")}; //# sourceMappingURL=multidb.min.map
